# JVideoAssist
#### 1. 简介

基于Android的平板客户端APP，和基于Linux主机的服务端开发，目的是辅助高空机械进行远程可视化作业。

#### 2. 功能需求

- 平板客户端app
  - 实现客户端实时显示远程相机的监控画面，支持4个通道的相机的显示
  - 实现基本的语音交互，达到利用简单语音识别技术，完成对设备的控制。
  - 支持自定义多个画面的显示，参考海康的监控软件设计
  - 灵活配置，可视化配置管理
- Linux服务端
  - 采集USB相机的图像数据
  - 将图像数据通过图片或者多媒体流的形式分发给客户端
  - 多个相机数据的管理
  - 流媒体数据推流和拉流
  - 服务端程序的部署平台

#### 3. 代码结构说明

- JVideoAssist 作为Android客户端的主项目文件夹，可以使用Android Studio打开此工程
- Doc 项目开发过程日志，主要记录了技术调研，开发过程中碰到的问题的解决，大部分是通过网上找到自己的需要和问题解决方案，然后不同尝试，修正。
- JVideoServer作为流媒体服务端的主项目文件夹,目前是一些部署运行脚本

#### 4. 技术方案的实现

###### 1）第一套

- client 由一个主activity+多个fragment+viewpager+recyleview+对应的adapter进行窗口布局设计
- 网络视频流采用webview来实时显示，默认支持URL的网络流式数据，一个相机画面对应一个webview，嵌套在recycleview的内容主控件内
- 处理好数据的刷新，画面的切割，配置的加载
- server端，主要依靠开源的多媒体服务器mjpeg-streamer, 部署在Linux主机上面，配置对应的相机节点和图像参数，如/dev/video0, img_width,img_height,fps等。
- client和server这种等同于自己利用socket通信，进行图片压缩处理后，进行远程网络传输，再在客户端进行一帧帧的渲染。
- 测试了主窗口同时显示1副，2副，4副的效果，延时情况。2副以下画面同时显示，延时比较低。

###### 2） 第二套

- 客户端视频显示画面由开源库NodeMediaPlayer-android提供的NodePlayer来实现.
- 界面布局设计是一个recycleview显示4画面模式,一个recycleview显示全屏模式
- 流媒体播放经过测试支持RTMP,RTSP的流媒体传输协议
- 服务端部署采用了SRS的简易RTMP搭建方案,以及直接基于FFMpeg推流形成的局域网网络流
- 语音识别直接集成科大讯飞的SDK, 根据官方的demo直接调用UI, 显示识别的结果.

3) 第三套

- Android客户端进行部分bug的优化, 播放的启动和停止控制, 系统设置参数的保存
- 服务端采用了电气提供的流媒体服务软件包 LiveCapture
- 每一个服务端程序负责采集一路USB相机的数据,然后进行视频编码,网络协议转发,封装成RTSP包, 对外部客户端提供拉流服务.
- 每个服务端livecatpure可执行程序,都对应一个同名的`LiveCapture.xml`配置文件, 可以配置服务的对应的相机的设备名称,采集原始图像大小,采集的帧率,输出视频的编码格式,输出图像的拼接位置,输出的图像的大小等.
- 服务端的部署方式采用了shell脚本控制启动和停止, 实现一键启动和停止所有进程服务.
- 服务端的源码由于保密等限制,存储于内部OA系统内. 需要向领导申请,提出到外部研究.也可以自己手动编辑同步到外面电脑进行研究,开发,调试.



#### 5. 待优化的问题

1. 客户端:
   - 客户端JVideoAssist App程序需要优化全屏和退出全屏的切换方案, 实现player播放控件的封装,内部支持全屏和非全屏,再嵌入到容器里面显示.
   - 客户端需要进一步优化解码和渲染性能, 减少视频播放的延时, 提升实时渲染性能.
   - 数据的保存方式和PC端的不一样, 移动端的通常不能浏览到本地配置文件,再进行修改,使得程序参数发生变化.需要参数的设置界面来显示配置. 建议使用保留历史输入,支持编辑的组合选择框来进行单项的设置.参考VLC播放器的播放网络媒体的输入框.
   - 程序的稳定性优化
2. 服务端
   - 当前无线局域网测试结果,单独某个画面视频延时1秒左右. 还存在进一步优化需要
   - 服务端由于拿不到完整的代码,播放的客户端也是. 所以不能实现外包需求要求的<200ms的播放延时
   - 服务端的实现的掌握, 根据项目进行适配
   - 解决服务端程序部署到不同平台的问题
   - 研究其他的实现方案,并测试效果.

#### 6. 备注

- 前期技术学习和预先开发已经告一段落, 2021年03月08日
- 准备基于前期的经验,将项目重构一个版本, 参考其他的开源项目设计,优化项目结构, 直接面向正式的需求原型设计

感谢，加油每一天。